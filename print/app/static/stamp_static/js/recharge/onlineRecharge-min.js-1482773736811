var paymentTP=null;var PAYMENT_TYPE={ZFB:"0",WY:"1",CZK:"2",WX:"5"};var interval=null;function setMoney(obj){if(obj.id=="money30"){if(!$("#"+obj.id).hasClass("btnmoney-select")){$("#"+obj.id).addClass("btnmoney-select");$("#money20").removeClass("btnmoney-select")}}else{if(!$("#"+obj.id).hasClass("btnmoney-select")){$("#"+obj.id).addClass("btnmoney-select");$("#money30").removeClass("btnmoney-select")}}var val=obj.value.toString().substring(0,obj.value.indexOf("元"));$("#realmoney").html(val);$("#WIDtotal_fee").val(val);$("#othermoney").val("");$("#presentmoney").html("")}function setButton(){if(!isEmptyValue($("#othermoney").val())){$("#othermoney").val($("#othermoney").val());$("#money20").removeClass("btnmoney-select");$("#money30").removeClass("btnmoney-select");$("#realmoney").html(parseInt($("#othermoney").val()));$("#WIDtotal_fee").val(parseInt($("#othermoney").val()));$("#presentmoney").html("")}}function setPayment(obj){if(obj.id=="zfbtype"){paymentTP=PAYMENT_TYPE.ZFB;if(!$("#"+obj.id).hasClass("zfbselect")){$("#"+obj.id).addClass("zfbselect");$("#wytype").removeClass("wyselect");$("#czktype").removeClass("czkselect");$("#wxtype").removeClass("wxselect")}}else{if(obj.id=="wytype"){paymentTP=PAYMENT_TYPE.WY;if(!$("#"+obj.id).hasClass("wyselect")){$("#"+obj.id).addClass("wyselect");$("#zfbtype").removeClass("zfbselect");$("#czktype").removeClass("czkselect");$("#wxtype").removeClass("wxselect")}}else{if(obj.id=="czktype"){paymentTP=PAYMENT_TYPE.CZK;$("#"+obj.id).addClass("czkselect");$("#zfbtype").removeClass("zfbselect");$("#wytype").removeClass("wyselect");$("#wxtype").removeClass("wxselect");$("#rcCode").val("");if(isEmptyValue($("#uId").text())){loginDiv();return false}validateIsOnline({confirmHandle:function(){ShowDiv("czkDiv","fade")}})}else{if(obj.id=="wxtype"){paymentTP=PAYMENT_TYPE.WX;if(!$("#"+obj.id).hasClass("wxselect")){$("#"+obj.id).addClass("wxselect");$("#wytype").removeClass("wyselect");$("#zfbtype").removeClass("zfbselect");$("#czktype").removeClass("czkselect")}}}}}$("#money20").removeClass("btnmoney-select");$("#money30").removeClass("btnmoney-select");$("#othermoney").val("");$("#realmoney").html("0");$("#WIDtotal_fee").val("");$("#presentmoney").html("")}function czkrecharge(){var rcCode=$("#rcCode").val();if(isEmptyValue(rcCode)){alertWarning("充值码不能为空！");return false}startWait();$.ajax({type:"post",url:"../recharge/useRechargeableCard.action?rcCode="+rcCode,success:function(data){if(data.toString().indexOf("window.top.location.href")>0){alertWarningCallBackDiv();return false}data=data.resultInfo;if(data.rsType==TYPE_RESULT.SUCCESS){closeWait();alertSuccess("充值成功");getUserMoney();CloseDiv("czkDiv","fade")}else{if(data.rsType==TYPE_RESULT.WARN){var rsData=eval("("+data.rsData+")");closeWait();alertWarning(rsData.ErrMsg);return false}else{closeWait();alertFail("充值卡充值失败！");return false}}}})}function paySubmit(){if(isEmptyValue($("#uId").text())){loginDiv();return false}validateIsOnline({confirmHandle:function(){setButton();if(isEmptyValue(paymentTP)){alertWarning("请选择充值方式！");return false}if(isEmptyValue($("#othermoney").val())){if(isEmptyValue($("#WIDtotal_fee").val())){alertWarning("请选择充值金额！");return false}}else{var money=$("#othermoney").val();if(money=="0"||money=="0."||money==".0"||money.substring(0,1)=="0"||money.substring(0,2)=="00"){alertWarning("无效金额,请选择充值金额！");$("#othermoney").val("");$("#realmoney").html("0");$("#WIDtotal_fee").val("");$("#presentmoney").html("");return false}if(parseFloat(money)<2){alertWarning("只能输入高于2元以上的金额！");$("#othermoney").val("");$("#realmoney").html("0");$("#WIDtotal_fee").val("");$("#presentmoney").html("");return false}}var wIDtotal_fee=$("#WIDtotal_fee").val();if(paymentTP==PAYMENT_TYPE.ZFB){alipay(wIDtotal_fee)}else{if(paymentTP==PAYMENT_TYPE.WY){cyberBank(wIDtotal_fee)}else{if(paymentTP==PAYMENT_TYPE.WX){startWait();$("#othermoney").val("");$("#realmoney").html("");$("#WIDtotal_fee").val("");$("#presentmoney").html("");$(".btnmoney-default").removeClass("btnmoney-select");$("#qrCode").attr("src","");$("#orderId").val("");$.ajax({type:"get",url:"../recharge/submitPayWx.action",data:{"WIDtotal_fee":wIDtotal_fee},success:function(data){if(data.toString().indexOf("window.top.location.href")>0){alertWarningCallBackDiv();return false}data=data.resultInfo;var rsData=eval("("+data.rsData+")");if(data.rsType==TYPE_RESULT.SUCCESS){closeWait();ShowDiv("weChatDiv","fade");$("#qrCode").attr("src","../recharge/getQrCode.action?data="+rsData.data);$("#orderId").val(rsData.orderId);interval=setInterval(queryOrderState,3000)}else{closeWait();alertFail("微信支付失败！");return false}}})}}}}})}function alipay(wIDtotal_fee){startWait();$.ajax({type:"get",url:"../recharge/submitPayAliPay.action?WIDtotal_fee="+wIDtotal_fee,success:function(data){if(data.toString().indexOf("window.top.location.href")>0){alertWarningCallBackDiv();return false}data=data.resultInfo;if(data.rsType==TYPE_RESULT.SUCCESS){closeWait();var formAlipay=document.getElementById("alipaysubmit");if(!isEmptyValue(formAlipay)){document.body.removeChild(formAlipay)
}$("body").append(data.rsData);$("#othermoney").val("");$("#realmoney").html("0");$("#WIDtotal_fee").val("");$("#presentmoney").html("");$(".btnmoney-default").removeClass("btnmoney-select")}else{closeWait();alertFail("支付宝支付失败！");return false}}})}function cyberBank(wIDtotal_fee){ShowDiv("MyDiv","fade");$('input[name="bankImg"]:checked').attr("checked",false);$(".bank").css("border","1px solid black");$(".bank").click(function(){$(this).prev().click();$(".bank").css("border","1px solid black");$(this).css("border","1px solid red")})}function funbank(){if(typeof($("input[name='bankImg']:checked").val())=="undefined"){alertWarning("请选择银行!");return false}else{var wIDtotal_fee=$("#WIDtotal_fee").val();startWait();$.ajax({type:"get",url:"../recharge/submitPaywy.action?WIDtotal_fee="+wIDtotal_fee+"&WIDdefaultbank="+$("input[name='bankImg']:checked").val(),success:function(data){if(data.toString().indexOf("window.top.location.href")>0){alertWarningCallBackDiv();return false}data=data.resultInfo;if(data.rsType==TYPE_RESULT.SUCCESS){closeWait();var formAlipay=document.getElementById("alipaysubmit");if(!isEmptyValue(formAlipay)){document.body.removeChild(formAlipay)}$("body").append(data.rsData);$("#othermoney").val("");$("#realmoney").html("0");$("#WIDtotal_fee").val("");$("#presentmoney").html("");$(".btnmoney-default").removeClass("btnmoney-select");CloseDiv("MyDiv","fade")}else{closeWait();alertFail("网银支付失败！");return false}}})}}function queryOrderState(orderId){$.ajax({type:"get",url:"../recharge/getOrderState.action?orderId="+$("#orderId").val(),data:{"orderId":orderId},dataType:"json",cache:false,async:false,success:function(data){if(data.toString().indexOf("window.top.location.href")>0){alertWarningCallBackDiv();return false}data=data.resultInfo;if(data.rsType==TYPE_RESULT.SUCCESS){$.ajax({type:"post",url:"../recharge/getUserMoney.action",success:function(data){if(data.toString().indexOf("window.top.location.href")>0){alertWarningCallBack();return false}data=data.resultInfo;if(data.rsType==TYPE_RESULT.SUCCESS){closeWeChat();var rsData=eval("("+data.rsData+")");var span='<span style="color: #ff9f38;">'+rsData.uMorney+"</span>";alertSuccess("充值成功,当前余额"+span+"快去打印吧!")}else{if(data.rsType==TYPE_RESULT.WARN){alertFail(rsData.msg);return false}else{alertFail("系统异常！");return false}}}})}}})}function closeWeChat(){clearInterval(interval);CloseDiv("weChatDiv","fade")};