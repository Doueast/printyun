$(function(){$("#find_loginname").val("");$("#loginname_store").val("");$("#question_store").val("");$("#input_answer_store").val("")});function getQuestion(){startWait();if($("#find_loginname").val()==""){closeWait();alertWarning("\u767b\u5f55\u8d26\u53f7\u4e0d\u80fd\u4e3a\u7a7a!");return false}else{if($("#input_answer").length==0){var loginName=$("#find_loginname").val();$("#loginname_store").val(loginName);$.ajax({type:"get",url:"../userLogin/isExistLoginName.action",data:{loginName:loginName},success:function(data){data=data.resultInfo;if(data.rsType==TYPE_RESULT.WARN){closeWait();alertWarning("\u767b\u5f55\u8d26\u53f7\u4e0d\u5b58\u5728\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165\uff01");return false}else{if(data.rsType==TYPE_RESULT.SUCCESS){$.ajax({type:"get",url:"../userLogin/getQuestion.action",cache:false,data:{loginname:loginName},dataType:"json",success:function(data){data=data.resultInfo;if(data.rsType==TYPE_RESULT.SUCCESS){var rsData=eval("("+data.rsData+")");if(isEmptyValue(rsData.question)){closeWait();alertWarning("\u60a8\u6ce8\u518c\u65f6\u6ca1\u6709\u586b\u5199\u5b89\u5168\u9a8c\u8bc1\u95ee\u9898\uff0c\u65e0\u6cd5\u627e\u56de\u5bc6\u7801\uff0c\u8bf7\u8054\u7cfb\u7ba1\u7406\u5458\uff01");return false}else{closeWait();$(".label_span").text(rsData.question);var input='<input id="input_answer" type="text" class="input" placeholder="\u8bf7\u8f93\u5165\u60a8\u7684\u7b54\u6848"/>';$(".value_span").html(input);var btn='<div class="submit_btn" onclick="submitAnswer()">\u4e0b\u4e00\u6b65</div>';$(".forget_btn_group").html(btn);$("#question_store").val(rsData.question);$(".second .circle").addClass("circleActive");$(".second p").addClass("textActive")}}else{if(data.rsType==TYPE_RESULT.FAIL){closeWait();alert("\u83b7\u53d6\u5b89\u5168\u95ee\u9898\u5931\u8d25\uff01");return false}else{if(data.rsType==TYPE_RESULT.WARN){closeWait();alert(data.ErrMsg);return false}}}}})}}}})}else{closeWait()}}}function submitAnswer(){startWait();if($("#new_pwd").length==0){if(isEmptyValue($("#input_answer").val())){closeWait();alertWarning("\u8bf7\u8f93\u5165\u5b89\u5168\u95ee\u9898\u7b54\u6848\uff01");$("#input_answer").val("");return false}var input_answer=$("#input_answer").val();$("#input_answer_store").val(input_answer);$.ajax({type:"get",url:"../userLogin/validateAnswer.action",data:{loginname:$("#loginname_store").val(),question:$("#question_store").val(),answer:input_answer},success:function(data){data=data.resultInfo;if(data.rsType==TYPE_RESULT.SUCCESS){closeWait();var param_div1='<div class="param_div" style="margin-right:50px;"><span class="star">*</span><span class="label_span">\u65b0\u5bc6\u7801:</span><span class="value_span"><input id="new_pwd" type="password" class="input" placeholder="\u8bf7\u8f93\u5165\u60a8\u7684\u65b0\u5bc6\u7801"/></span></div>';var param_div2='<div class="param_div" style="margin-top:20px;margin-right:50px;"><span class="star">*</span><span class="label_span">\u786e\u8ba4\u65b0\u5bc6\u7801:</span><span class="value_span"><input id="new_surepwd" type="password" class="input" placeholder="\u8bf7\u8f93\u5165\u60a8\u7684\u786e\u8ba4\u65b0\u5bc6\u7801"/></span></div>';$(".inputDiv").html(param_div1+param_div2);var btn='<div class="submit_btn" onclick="funupdpwd()">\u4e0b\u4e00\u6b65</div>';$(".forget_btn_group").html(btn);$(".third .circle").addClass("circleActive");$(".third p").addClass("textActive")}else{if(data.rsType==TYPE_RESULT.WARN){var rsData=eval("("+data.rsData+")");closeWait();alertWarning(rsData.ErrMsg);return false}else{closeWait();alertFail("\u7cfb\u7edf\u5f02\u5e38\uff01");return false}}}})}else{closeWait()}}function funupdpwd(){startWait();if(isEmptyValue($("#new_pwd").val())){closeWait();alertWarning("\u8bf7\u8f93\u5165\u65b0\u5bc6\u7801\uff01");return false}else{if($("#new_pwd").val().length<6){closeWait();alertWarning("\u5bc6\u7801\u957f\u5ea6\u81f3\u5c116\u4f4d\uff01");return false}}if(isEmptyValue($("#new_surepwd").val())){closeWait();alertWarning("\u8bf7\u518d\u6b21\u8f93\u5165\u5bc6\u7801\uff01");return false}else{if($("#new_surepwd").val().length<6){closeWait();alertWarning("\u5bc6\u7801\u957f\u5ea6\u81f3\u5c116\u4f4d\uff01");return false}}if($("#new_pwd").val()!=$("#new_surepwd").val()){closeWait();alertWarning("\u4e24\u6b21\u5bc6\u7801\u8f93\u5165\u4e0d\u4e00\u81f4\uff01");return false}$.ajax({type:"get",url:"../userLogin/resetPwd.action",data:{loginname:$("#loginname_store").val(),question:$("#question_store").val(),answer:$("#input_answer_store").val(),password:$("#new_pwd").val()},success:function(data){data=data.resultInfo;if(data.rsType==TYPE_RESULT.SUCCESS){closeWait();$("#loginname_store").val("");$("#question_store").val("");$("#input_answer_store").val("");$("#new_pwd").val("");$("#new_surepwd").val("");$(".fourth .circle").addClass("circleActive");$(".fourth p").addClass("textActive");var div='<div style="font-size:16px;text-align: center;">\u606d\u559c\u4f60\u6210\u529f\u627e\u56de\u5bc6\u7801,\u4f60\u9700\u8981\u91cd\u65b0\u767b\u5f55\u7cfb\u7edf!</div><div style="text-align: center;color:#666666;"><span id="jumpTo">5</span>\u79d2\u540e\u81ea\u52a8\u8df3\u8f6c\u5230\u767b\u5f55\u9875\u9762</div>';$(".inputDiv").html(div);var btn='<div class="submit_btn" onclick="toLogin()">\u786e\u5b9a</div>';$(".forget_btn_group").html(btn);countDown(5)}else{if(data.rsType==TYPE_RESULT.WARN){var rsData=eval("("+data.rsData+")");closeWait();alertWarning(rsData.ErrMsg);return false}else{closeWait();alertFail("\u4fee\u6539\u5bc6\u7801\u5931\u8d25\uff0c\u8bf7\u8054\u7cfb\u7ba1\u7406\u5458\uff01");return false}}}})}function countDown(b){var a=document.getElementById("jumpTo");a.innerHTML=b;if(--b>0){setTimeout("countDown("+b+")",1000)}else{toLogin()}};
